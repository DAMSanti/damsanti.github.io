<!DOCTYPE html>
<html>
<head>
    <title>Seleccionar archivo .html</title>
    <!-- Carga los estilos y scripts de CodeMirror -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.1/mode/clike/clike.min.js"></script>
    <style>
        /* Estilos para el área de CodeMirror */
        #javaCodeEditorContainer {
            height: 65vh !important;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>Selecciona un ejercicio:</h1>
    <select id="unidadSelect">
        <option value="">Selecciona una unidad</option>
    </select>

    <select id="hojaSelect">
        <option value="">Selecciona una hoja</option>
    </select>

    <select id="ejercicioSelect">
        <option value="">Selecciona un ejercicio</option>
    </select>
    
    <br>
    <!-- Reemplaza el textarea por el editor de CodeMirror -->
    <div id="javaCodeEditorContainer"></div>
    <br>

    <hr>
    
    <button onclick="loadAndRunHTML()">Run</button>

    <h1>Salida:</h1>
    <iframe id="output" style="width: 100%; height: 300px;"></iframe>

    <script>
        const unidadSelect = document.getElementById('unidadSelect');
        const hojaSelect = document.getElementById('hojaSelect');
        const ejercicioSelect = document.getElementById('ejercicioSelect');
        const javaCodeEditorContainer = document.getElementById('javaCodeEditorContainer');
        const output = document.getElementById('output');
        let selectedHTMLFile = ''; // Variable para almacenar el nombre del archivo .html
        let selectedPath = '';
        let codeMirrorInstance = null;
        
        // Función para cargar y mostrar el código HTML seleccionado
        unidadSelect.addEventListener('change', loadHojas);
        hojaSelect.addEventListener('change', loadEjercicios);
        ejercicioSelect.addEventListener('change', loadHTMLCode);

        // Cargar las unidades disponibles al cargar la página
        window.addEventListener('load', () => {
            fetch('/data/lista-archivos-java.json') // Reemplaza con la ruta de tu servidor para obtener la lista de archivos HTML
                .then(response => response.json())
                .then(data => {
                    const unidades = [...new Set(data.map(file => file.unidad))];
                    unidades.forEach(unidad => {
                        const option = document.createElement('option');
                        option.value = unidad;
                        option.textContent = unidad;
                        unidadSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error(error);
                });
        });

        // Cargar las hojas disponibles cuando se selecciona una unidad
        function loadHojas() {
            const selectedUnidad = unidadSelect.value;
            hojaSelect.innerHTML = '<option value="">Selecciona una hoja</option>'; // Limpiar las opciones anteriores

            if (selectedUnidad) {
                fetch('/data/lista-archivos-java.json') // Reemplaza con la ruta de tu servidor para obtener la lista de archivos HTML
                    .then(response => response.json())
                    .then(data => {
                        const hojas = [...new Set(data.filter(file => file.unidad === selectedUnidad).map(file => file.Hoja))];
                        hojas.forEach(hoja => {
                            const option = document.createElement('option');
                            option.value = hoja;
                            option.textContent = hoja;
                            hojaSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        }

        // Cargar los ejercicios disponibles cuando se selecciona una hoja
        function loadEjercicios() {
            const selectedUnidad = unidadSelect.value;
            const selectedHoja = hojaSelect.value;
            ejercicioSelect.innerHTML = '<option value="">Selecciona un ejercicio</option>'; // Limpiar las opciones anteriores

            if (selectedUnidad && selectedHoja) {
                fetch('/data/lista-archivos-java.json') // Reemplaza con la ruta de tu servidor para obtener la lista de archivos HTML
                    .then(response => response.json())
                    .then(data => {
                        const ejercicios = data.filter(file => file.unidad === selectedUnidad && file.Hoja === selectedHoja);
                        ejercicios.forEach(ejercicio => {
                            const option = document.createElement('option');
                            option.value = ejercicio.nombre;
                            option.textContent = ejercicio.nombre.replace(/\.html$/, '');
                            ejercicioSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }
        }

        function loadHTMLCode() {
            const selectedHTMLFile = ejercicioSelect.value;
            if (selectedHTMLFile) {
                fetch('/data/lista-archivos-java.json')
                    .then(response => response.json())
                    .then(data => {
                        const selectedFileData = data.find(file => file.nombre === selectedHTMLFile);
                        if (selectedFileData) {
                            selectedPath = selectedFileData.ruta;
                            const fullHTMLFilePath = `${selectedPath}${selectedHTMLFile}`;
                            fetch(fullHTMLFilePath)
                                .then(response => response.text())
                                .then(htmlCode => {
                                    // Mostrar el HTML en el iframe
                                    output.srcdoc = htmlCode;
                                })
                                .catch(error => {
                                    console.error(error);
                                });
                        } else {
                            console.error('Datos del archivo no encontrados en el JSON.');
                        }
                    })
                    .catch(error => {
                        console.error(error);
                    });
            } else {
                // Limpiar el contenido del iframe si no se selecciona ningún ejercicio
                output.srcdoc = '';
            }
        }

        // Función para ejecutar el archivo .html
        function loadAndRunHTML() {
            const selectedHTMLFile = ejercicioSelect.value;
            if (!selectedHTMLFile) {
                alert('Selecciona un archivo .html primero.');
                return;
            }
            
            loadHTMLCode(); // Cargar y mostrar el archivo HTML seleccionado
        }
    </script>
</body>
</html>
